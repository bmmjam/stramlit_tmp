import streamlit as st
import pandas as pd
import os
import csv

# Список студентов с полными именами
students_list = [
    {"ID": "001", "ФИО": "Безмозгий Игорь Леонидович"},
    {"ID": "002", "ФИО": "Добровольский Иван Александрович"},
    {"ID": "003", "ФИО": "Егоров Сергей Евгеньевич"},
    {"ID": "004", "ФИО": "Жилов Андрей Алексеевич"},
    {"ID": "005", "ФИО": "Жуков Тимофей Владимирович"},
    {"ID": "006", "ФИО": "Ибрашов Джамал Ербулатович"},
    {"ID": "007", "ФИО": "Кандуев Санджи Николаевич"},
    {"ID": "008", "ФИО": "Кнышенко Павел Михайлович"},
    {"ID": "009", "ФИО": "Козлов Егор Сергеевич"},
    {"ID": "010", "ФИО": "Кунгуров Михаил Сергеевич"},
    {"ID": "011", "ФИО": "Кутузова Ксения Альбертовна"},
    {"ID": "012", "ФИО": "Мазурец Кирилл Александрович"},
    {"ID": "013", "ФИО": "Минеев Артём Олегович"},
    {"ID": "014", "ФИО": "Николаев Максим Андреевич"},
    {"ID": "015", "ФИО": "Османкин Александр Евгеньевич"},
    {"ID": "016", "ФИО": "Попов Леонид Дмитриевич"},
    {"ID": "017", "ФИО": "Репко Андрей Андреевич"},
    {"ID": "018", "ФИО": "Свистельников Илья Вадимович"},
    {"ID": "019", "ФИО": "Силаева Владислава Сергеевна"},
    {"ID": "020", "ФИО": "Ситдиков Ришат Филюсович"},
    {"ID": "021", "ФИО": "Солдатова Наталья Евгеньевна"},
    {"ID": "022", "ФИО": "Сухоруков Даниил Александрович"},
    {"ID": "023", "ФИО": "Титеев Рамиль Маратович"},
    {"ID": "024", "ФИО": "Чухно Владислав Иванович"},
    {"ID": "025", "ФИО": "Шилов Кирилл Михайлович"},
]

# Путь к файлу с коэффициентами
coefficients_file = "coefficients.csv"

# Проверяем наличие файла с коэффициентами, если нет - создаем
if not os.path.exists(coefficients_file):
    with open(coefficients_file, "w", newline='', encoding='utf-8') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(["ID", "ФИО", "Коэффициент"])
        for student in students_list:
            writer.writerow([student["ID"], student["ФИО"], ""])

# Функция для чтения коэффициентов из файла
def read_coefficients():
    df = pd.read_csv(coefficients_file)
    return df

# Функция для записи коэффициентов в файл
def write_coefficients(df):
    df.to_csv(coefficients_file, index=False)

# Основное приложение
st.title("Выбор коэффициентов студентами")
st.write("Каждый студент может ввести свой выбранный коэффициент. Изменения будут видны всем.")

# Чтение текущих коэффициентов
coeff_df = read_coefficients()

# Создание списка имен студентов для выбора
student_names = coeff_df["ФИО"].tolist()

# Выбор студента из списка
selected_name = st.selectbox("Выберите свое имя", student_names)

# Получаем текущий коэффициент студента
current_coef = coeff_df.loc[coeff_df["ФИО"] == selected_name, "Коэффициент"].values[0]

# Поле для ввода коэффициента
coef_input = st.text_input(
    "Введите ваш коэффициент (целое число от 1 до 27)",
    value=str(current_coef) if pd.notna(current_coef) else "",
    max_chars=2  # Ограничение на количество символов
)

# Кнопка для сохранения коэффициента
if st.button("Сохранить коэффициент"):
    # Проверка корректности введенного значения
    if coef_input.isdigit() and 1 <= int(coef_input) <= 27:
        # Обновляем коэффициент в DataFrame
        coeff_df.loc[coeff_df["ФИО"] == selected_name, "Коэффициент"] = int(coef_input)
        # Пишем в файл
        write_coefficients(coeff_df)
        st.success("Коэффициент успешно сохранен!")
    else:
        st.error("Пожалуйста, введи целое число от 1 до 27.")

# Отображение текущих коэффициентов
st.write("### Текущие коэффициенты студентов")
st.dataframe(coeff_df[["ФИО", "Коэффициент"]])
